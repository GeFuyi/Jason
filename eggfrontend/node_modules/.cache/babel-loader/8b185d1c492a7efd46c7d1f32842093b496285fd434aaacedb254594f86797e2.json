{"ast":null,"code":"import { ref, reactive, onMounted } from \"vue\";\nimport egg from '@/utils/egg';\nimport { ElMessageBox } from \"element-plus\";\nexport default {\n  name: \"UserList\",\n  setup() {\n    const criteria = reactive({\n      username: null,\n      email: null,\n      age: null,\n      gender: null\n    });\n    const usernameList = ref([]);\n    const emailList = ref([]);\n    const ageList = ref([]);\n    const pagedUsers = ref([]);\n    const page = ref(1);\n    const pageSize = ref(10);\n    const total = ref(0);\n    const totalPages = ref(1);\n    const pageSizes = ref([5, 10, 20]);\n    const dialogVisible = ref(false);\n    const dialogTitle = ref(\"新增用户\");\n    const formUser = reactive({\n      id: null,\n      username: \"\",\n      email: \"\",\n      password: \"\",\n      age: null,\n      gender: 1\n    });\n    const buildQueryParams = () => {\n      const params = {\n        page: page.value,\n        pageSize: pageSize.value\n      };\n      if (criteria.username) params.username = criteria.username;\n      if (criteria.email) params.email = criteria.email;\n      if (criteria.age) params.age = criteria.age;\n      if (criteria.gender !== null && criteria.gender !== \"\") params.gender = criteria.gender;\n      return params;\n    };\n    const fetchOptions = async () => {\n      // 不需要 try/catch，错误会在 egg.js 统一弹窗\n      const [uRes, eRes, aRes] = await Promise.all([egg.get(`/user/options/username`), egg.get(`/user/options/email`), egg.get(`/user/options/age`)]);\n      usernameList.value = Array.isArray(uRes) ? uRes : [];\n      emailList.value = Array.isArray(eRes) ? eRes : [];\n      ageList.value = Array.isArray(aRes) ? aRes : [];\n    };\n    const fetchUsers = async () => {\n      const res = await egg.get(`/user/query`, {\n        params: buildQueryParams()\n      });\n      pagedUsers.value = Array.isArray(res.data) ? res.data : [];\n      total.value = res.total || 0;\n      totalPages.value = Math.max(1, Math.ceil(total.value / pageSize.value));\n    };\n    const onQuery = async () => {\n      page.value = 1;\n      await fetchUsers();\n    };\n    const onReset = async () => {\n      criteria.username = null;\n      criteria.email = null;\n      criteria.age = null;\n      criteria.gender = null;\n      page.value = 1;\n      await fetchUsers();\n    };\n    const changePage = async p => {\n      page.value = p;\n      await fetchUsers();\n    };\n    const handleSizeChange = async newSize => {\n      pageSize.value = newSize;\n      page.value = 1;\n      await fetchUsers();\n    };\n    const openDialog = (type, user = null) => {\n      dialogTitle.value = type === \"add\" ? \"新增用户\" : \"编辑用户\";\n      if (user) {\n        Object.assign(formUser, user);\n      } else {\n        formUser.id = null;\n        formUser.username = \"\";\n        formUser.email = \"\";\n        formUser.password = \"\";\n        formUser.age = null;\n        formUser.gender = 1;\n      }\n      dialogVisible.value = true;\n    };\n    const saveUser = async () => {\n      if (formUser.id) {\n        await egg.put(`/user/${formUser.id}`, {\n          ...formUser\n        });\n      } else {\n        await egg.post(`/user`, {\n          ...formUser\n        });\n      }\n      dialogVisible.value = false;\n      await fetchOptions();\n      await fetchUsers();\n    };\n    const confirmDelete = async id => {\n      await ElMessageBox.confirm(\"确定要删除该用户吗？\", \"删除确认\", {\n        confirmButtonText: \"确定\",\n        cancelButtonText: \"取消\",\n        type: \"warning\"\n      });\n      await egg.delete(`/user/${id}`);\n      await fetchOptions();\n      await fetchUsers();\n    };\n    onMounted(async () => {\n      await fetchOptions();\n      await fetchUsers();\n    });\n    return {\n      criteria,\n      usernameList,\n      emailList,\n      ageList,\n      pagedUsers,\n      page,\n      pageSize,\n      total,\n      totalPages,\n      pageSizes,\n      dialogVisible,\n      dialogTitle,\n      formUser,\n      onQuery,\n      onReset,\n      changePage,\n      handleSizeChange,\n      openDialog,\n      saveUser,\n      confirmDelete\n    };\n  }\n};","map":{"version":3,"names":["ref","reactive","onMounted","egg","ElMessageBox","name","setup","criteria","username","email","age","gender","usernameList","emailList","ageList","pagedUsers","page","pageSize","total","totalPages","pageSizes","dialogVisible","dialogTitle","formUser","id","password","buildQueryParams","params","value","fetchOptions","uRes","eRes","aRes","Promise","all","get","Array","isArray","fetchUsers","res","data","Math","max","ceil","onQuery","onReset","changePage","p","handleSizeChange","newSize","openDialog","type","user","Object","assign","saveUser","put","post","confirmDelete","confirm","confirmButtonText","cancelButtonText","delete"],"sources":["D:\\Final\\springboot_egg\\egg-web\\src\\user\\UserList.vue"],"sourcesContent":["<script>\r\nimport {ref, reactive, onMounted} from \"vue\";\r\nimport egg from '@/utils/egg'\r\nimport {ElMessageBox} from \"element-plus\";\r\n\r\nexport default {\r\n  name: \"UserList\",\r\n  setup() {\r\n    const criteria = reactive({username: null, email: null, age: null, gender: null});\r\n    const usernameList = ref([]);\r\n    const emailList = ref([]);\r\n    const ageList = ref([]);\r\n\r\n    const pagedUsers = ref([]);\r\n    const page = ref(1);\r\n    const pageSize = ref(10);\r\n    const total = ref(0);\r\n    const totalPages = ref(1);\r\n    const pageSizes = ref([5, 10, 20]);\r\n\r\n    const dialogVisible = ref(false);\r\n    const dialogTitle = ref(\"新增用户\");\r\n    const formUser = reactive({id: null, username: \"\", email: \"\", password: \"\", age: null, gender: 1});\r\n\r\n    const buildQueryParams = () => {\r\n      const params = {page: page.value, pageSize: pageSize.value};\r\n      if (criteria.username) params.username = criteria.username;\r\n      if (criteria.email) params.email = criteria.email;\r\n      if (criteria.age) params.age = criteria.age;\r\n      if (criteria.gender !== null && criteria.gender !== \"\") params.gender = criteria.gender;\r\n      return params;\r\n    };\r\n\r\n    const fetchOptions = async () => {\r\n      // 不需要 try/catch，错误会在 egg.js 统一弹窗\r\n      const [uRes, eRes, aRes] = await Promise.all([\r\n        egg.get(`/user/options/username`),\r\n        egg.get(`/user/options/email`),\r\n        egg.get(`/user/options/age`),\r\n      ]);\r\n      usernameList.value = Array.isArray(uRes) ? uRes : [];\r\n      emailList.value = Array.isArray(eRes) ? eRes : [];\r\n      ageList.value = Array.isArray(aRes) ? aRes : [];\r\n    };\r\n\r\n    const fetchUsers = async () => {\r\n      const res = await egg.get(`/user/query`, {params: buildQueryParams()});\r\n      pagedUsers.value = Array.isArray(res.data) ? res.data : [];\r\n      total.value = res.total || 0;\r\n      totalPages.value = Math.max(1, Math.ceil(total.value / pageSize.value));\r\n    };\r\n\r\n    const onQuery = async () => {\r\n      page.value = 1;\r\n      await fetchUsers();\r\n    };\r\n\r\n    const onReset = async () => {\r\n      criteria.username = null;\r\n      criteria.email = null;\r\n      criteria.age = null;\r\n      criteria.gender = null;\r\n      page.value = 1;\r\n      await fetchUsers();\r\n    };\r\n\r\n    const changePage = async (p) => {\r\n      page.value = p;\r\n      await fetchUsers();\r\n    };\r\n\r\n    const handleSizeChange = async (newSize) => {\r\n      pageSize.value = newSize;\r\n      page.value = 1;\r\n      await fetchUsers();\r\n    };\r\n\r\n    const openDialog = (type, user = null) => {\r\n      dialogTitle.value = type === \"add\" ? \"新增用户\" : \"编辑用户\";\r\n      if (user) {\r\n        Object.assign(formUser, user);\r\n      } else {\r\n        formUser.id = null;\r\n        formUser.username = \"\";\r\n        formUser.email = \"\";\r\n        formUser.password = \"\";\r\n        formUser.age = null;\r\n        formUser.gender = 1;\r\n      }\r\n      dialogVisible.value = true;\r\n    };\r\n\r\n    const saveUser = async () => {\r\n      if (formUser.id) {\r\n        await egg.put(`/user/${formUser.id}`, {...formUser});\r\n      } else {\r\n        await egg.post(`/user`, {...formUser});\r\n      }\r\n      dialogVisible.value = false;\r\n      await fetchOptions();\r\n      await fetchUsers();\r\n    };\r\n\r\n    const confirmDelete = async (id) => {\r\n      await ElMessageBox.confirm(\"确定要删除该用户吗？\", \"删除确认\", {\r\n        confirmButtonText: \"确定\",\r\n        cancelButtonText: \"取消\",\r\n        type: \"warning\",\r\n      });\r\n      await egg.delete(`/user/${id}`);\r\n      await fetchOptions();\r\n      await fetchUsers();\r\n    };\r\n\r\n    onMounted(async () => {\r\n      await fetchOptions();\r\n      await fetchUsers();\r\n    });\r\n\r\n    return {\r\n      criteria,\r\n      usernameList,\r\n      emailList,\r\n      ageList,\r\n      pagedUsers,\r\n      page,\r\n      pageSize,\r\n      total,\r\n      totalPages,\r\n      pageSizes,\r\n      dialogVisible,\r\n      dialogTitle,\r\n      formUser,\r\n      onQuery,\r\n      onReset,\r\n      changePage,\r\n      handleSizeChange,\r\n      openDialog,\r\n      saveUser,\r\n      confirmDelete,\r\n    };\r\n  },\r\n};\r\n</script>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}